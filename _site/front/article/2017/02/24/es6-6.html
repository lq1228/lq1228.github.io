<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ES6语法之六（数组的扩展）</title>
  <meta name="description" content="数组的扩展">

  <link rel="stylesheet" href="/stylesheets/stylesheet.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://lq1228.github.io//front/article/2017/02/24/es6-6.html">
  <link rel="alternate" type="application/rss+xml" title="lq1228.github.io" href="http://lq1228.github.io//feed.xml">
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
</head>


  <body>

    <header class="main-header">
    <div class="inner">
        <h1>liqian</h1>
        <blockquote>
            <p>
            <p>
        </blockquote>
        <a href="https://github.com/lq1228" class="button"><small>Follow me on</small> GitHub</a>
    </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <nav>当前位置：<a href="/">首页</a> &gt; <a href="/front/article/2017/02/24/es6-6.html">ES6语法之六（数组的扩展）</a></nav>
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">ES6语法之六（数组的扩展）</h1>
    <p class="post-meta"><time datetime="2017-02-24T10:49:42+08:00" itemprop="datePublished">Feb 24, 2017</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h3 id="arrayfrom">1. Array.from()</h3>

<p>Array.from方法用于将两类对象转为真正的数组：类似数组的对象（array-like object）和可遍历（iterable）的对象（包括ES6新增的数据结构Set和Map）。</p>

<p>下面是一个类似数组的对象，Array.from将它转为真正的数组。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">arrayLike</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'0'</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">,</span>
    <span class="s1">'1'</span><span class="p">:</span> <span class="s1">'b'</span><span class="p">,</span>
    <span class="s1">'2'</span><span class="p">:</span> <span class="s1">'c'</span><span class="p">,</span>
    <span class="na">length</span><span class="p">:</span> <span class="mi">3</span>
<span class="p">};</span>

<span class="c1">// ES5的写法</span>
<span class="kd">var</span> <span class="nx">arr1</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arrayLike</span><span class="p">);</span> <span class="c1">// ['a', 'b', 'c']</span>

<span class="c1">// ES6的写法</span>
<span class="kd">let</span> <span class="nx">arr2</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">arrayLike</span><span class="p">);</span> <span class="c1">// ['a', 'b', 'c']</span></code></pre></figure>

<p>实际应用中，常见的类似数组的对象是DOM操作返回的NodeList集合，以及函数内部的arguments对象。Array.from都可以将它们转为真正的数组。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// NodeList对象</span>
<span class="kd">let</span> <span class="nx">ps</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">);</span>
<span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">ps</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// arguments对象</span>
<span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
  <span class="c1">// ...</span>
<span class="p">}</span></code></pre></figure>

<p>上面代码中，querySelectorAll方法返回的是一个类似数组的对象，只有将这个对象转为真正的数组，才能使用forEach方法。</p>

<p>只要是部署了Iterator接口的数据结构，Array.from都能将其转为数组。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span>
<span class="c1">// ['h', 'e', 'l', 'l', 'o']</span>

<span class="kd">let</span> <span class="nx">namesSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Set</span><span class="p">([</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">])</span>
<span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">namesSet</span><span class="p">)</span> <span class="c1">// ['a', 'b']</span></code></pre></figure>

<p>上面代码中，字符串和Set结构都具有Iterator接口，因此可以被Array.from转为真正的数组。</p>

<p>如果参数是一个真正的数组，Array.from会返回一个一模一样的新数组。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>	<span class="c1">// [1, 2, 3]</span></code></pre></figure>

<p>值得提醒的是，扩展运算符（…）也可以将某些数据结构转为数组。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// arguments对象</span>
<span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">arguments</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// NodeList对象</span>
<span class="p">[...</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'div'</span><span class="p">)]</span></code></pre></figure>

<p>扩展运算符背后调用的是遍历器接口（Symbol.iterator），如果一个对象没有部署这个接口，就无法转换。Array.from方法则是还支持类似数组的对象。所谓类似数组的对象，本质特征只有一点，即必须有length属性。因此，任何有length属性的对象，都可以通过Array.from方法转为数组，而此时扩展运算符就无法转换。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">({</span> <span class="na">length</span><span class="p">:</span> <span class="mi">3</span> <span class="p">});</span>	<span class="c1">// [ undefined, undefined, undefined ]</span></code></pre></figure>

<p>上面代码中，Array.from返回了一个具有三个成员的数组，每个位置的值都是undefined。扩展运算符转换不了这个对象。</p>

<p>对于还没有部署该方法的浏览器，可以用Array.prototype.slice方法替代。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">toArray</span> <span class="o">=</span> <span class="p">(()</span> <span class="o">=&gt;</span>
  <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span> <span class="p">?</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span> <span class="p">:</span> <span class="nx">obj</span> <span class="o">=&gt;</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
<span class="p">)();</span></code></pre></figure>

<p>Array.from还可以接受第二个参数，作用类似于数组的map方法，用来对每个元素进行处理，将处理后的值放入返回的数组。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">arrayLike</span><span class="p">,</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">);</span>	<span class="c1">// 等同于</span>
<span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">arrayLike</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">);</span>

<span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span>	<span class="c1">// [1, 4, 9]</span></code></pre></figure>

<p>下面的例子是取出一组DOM节点的文本内容。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">spans</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'span.name'</span><span class="p">);</span>

<span class="c1">// map()</span>
<span class="kd">let</span> <span class="nx">names1</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">spans</span><span class="p">,</span> <span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">textContent</span><span class="p">);</span>

<span class="c1">// Array.from()</span>
<span class="kd">let</span> <span class="nx">names2</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">spans</span><span class="p">,</span> <span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">textContent</span><span class="p">)</span></code></pre></figure>

<p>下面的例子将数组中布尔值为false的成员转为0。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">n</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span>	<span class="c1">// [1, 0, 2, 0, 3]</span></code></pre></figure>

<p>另一个例子是返回各种数据的类型。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">typesOf</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="k">typeof</span> <span class="nx">value</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">typesOf</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">NaN</span><span class="p">)</span>	<span class="c1">// ['object', 'object', 'number']</span></code></pre></figure>

<p>如果map函数里面用到了this关键字，还可以传入Array.from的第三个参数，用来绑定this。</p>

<p>Array.from()可以将各种值转为真正的数组，并且还提供map功能。这实际上意味着，只要有一个原始的数据结构，你就可以先对它的值进行处理，然后转成规范的数组结构，进而就可以使用数量众多的数组方法。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">({</span> <span class="na">length</span><span class="p">:</span> <span class="mi">2</span> <span class="p">},</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="s1">'jack'</span><span class="p">)</span>		<span class="c1">// ['jack', 'jack']</span></code></pre></figure>

<p>上面代码中，Array.from的第一个参数指定了第二个参数运行的次数。这种特性可以让该方法的用法变得非常灵活。</p>

<p>Array.from()的另一个应用是，将字符串转为数组，然后返回字符串的长度。因为它能正确处理各种Unicode字符，可以避免JavaScript将大于\uFFFF的Unicode字符，算作两个字符的bug。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">countSymbols</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">string</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<h3 id="arrayof">2. Array.of()</h3>

<p>Array.of方法用于将一组值，转换为数组。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Array</span><span class="p">.</span><span class="nx">of</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1">// [3,11,8]</span>
<span class="nb">Array</span><span class="p">.</span><span class="nx">of</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">// [3]</span>
<span class="nb">Array</span><span class="p">.</span><span class="nx">of</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nx">length</span> <span class="c1">// 1</span></code></pre></figure>

<p>这个方法的主要目的，是弥补数组构造函数Array()的不足。因为参数个数的不同，会导致Array()的行为有差异。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Array</span><span class="p">()</span> <span class="c1">// []</span>
<span class="nb">Array</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">// [, , ,]</span>
<span class="nb">Array</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1">// [3, 11, 8]</span></code></pre></figure>

<p>上面代码中，Array方法没有参数、一个参数、三个参数时，返回结果都不一样。只有当参数个数不少于2个时，Array()才会返回由参数组成的新数组。参数个数只有一个时，实际上是指定数组的长度。</p>

<p>Array.of基本上可以用来替代Array()或new Array()，并且不存在由于参数不同而导致的重载。它的行为非常统一。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Array</span><span class="p">.</span><span class="nx">of</span><span class="p">()</span> <span class="c1">// []</span>
<span class="nb">Array</span><span class="p">.</span><span class="nx">of</span><span class="p">(</span><span class="kc">undefined</span><span class="p">)</span> <span class="c1">// [undefined]</span>
<span class="nb">Array</span><span class="p">.</span><span class="nx">of</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// [1]</span>
<span class="nb">Array</span><span class="p">.</span><span class="nx">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">// [1, 2]</span></code></pre></figure>

<p>Array.of总是返回参数值组成的数组。如果没有参数，就返回一个空数组。</p>

<p>Array.of方法可以用下面的代码模拟实现。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">ArrayOf</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<h3 id="copywithin">3. 数组实例的copyWithin()</h3>

<p>数组实例的copyWithin方法，在当前数组内部，将指定位置的成员复制到其他位置（会覆盖原有成员），然后返回当前数组。也就是说，使用这个方法，会修改当前数组。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">copyWithin</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">end</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span></code></pre></figure>

<p>它接受三个参数。</p>

<p>target（必需）：从该位置开始替换数据。</p>

<p>start（可选）：从该位置开始读取数据，默认为0。如果为负值，表示倒数。</p>

<p>end（可选）：到该位置前停止读取数据，默认等于数组长度。如果为负值，表示倒数。</p>

<p>这三个参数都应该是数值，如果不是，会自动转为数值。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">].</span><span class="nx">copyWithin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>	<span class="c1">// [4, 5, 3, 4, 5]</span></code></pre></figure>

<p>上面代码表示将从3号位直到数组结束的成员（4和5），复制到从0号位开始的位置，结果覆盖了原来的1和2。</p>

<p>下面是更多例子。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 将3号位复制到0号位</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">].</span><span class="nx">copyWithin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1">// [4, 2, 3, 4, 5]</span>

<span class="c1">// -2相当于3号位，-1相当于4号位</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">].</span><span class="nx">copyWithin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">// [4, 2, 3, 4, 5]</span>

<span class="c1">// 将3号位复制到0号位</span>
<span class="p">[].</span><span class="nx">copyWithin</span><span class="p">.</span><span class="nx">call</span><span class="p">({</span><span class="na">length</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1">// {0: 1, 3: 1, length: 5}</span>

<span class="c1">// 将2号位到数组结束，复制到0号位</span>
<span class="kd">var</span> <span class="nx">i32a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Int32Array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>
<span class="nx">i32a</span><span class="p">.</span><span class="nx">copyWithin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="c1">// Int32Array [3, 4, 5, 4, 5]</span>

<span class="c1">// 对于没有部署TypedArray的copyWithin方法的平台</span>
<span class="c1">// 需要采用下面的写法</span>
<span class="p">[].</span><span class="nx">copyWithin</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">new</span> <span class="nx">Int32Array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="c1">// Int32Array [4, 2, 3, 4, 5]</span></code></pre></figure>

<h3 id="findfindindex">4. 数组实例的find()和findIndex()</h3>

<p>数组实例的find方法，用于找出第一个符合条件的数组成员。它的参数是一个回调函数，所有数组成员依次执行该回调函数，直到找出第一个返回值为true的成员，然后返回该成员。如果没有符合条件的成员，则返回undefined。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">].</span><span class="nx">find</span><span class="p">((</span><span class="nx">n</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>	<span class="c1">// -5</span></code></pre></figure>

<p>上面代码找出数组中第一个小于0的成员。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">].</span><span class="nx">find</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">value</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">;</span>
<span class="p">})</span> <span class="c1">// 10</span></code></pre></figure>

<p>上面代码中，find方法的回调函数可以接受三个参数，依次为当前的值、当前的位置和原数组。</p>

<p>数组实例的findIndex方法的用法与find方法非常类似，返回第一个符合条件的数组成员的位置，如果所有成员都不符合条件，则返回-1。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">].</span><span class="nx">findIndex</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">value</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">;</span>
<span class="p">})</span> <span class="c1">// 2</span></code></pre></figure>

<p>这两个方法都可以接受第二个参数，用来绑定回调函数的this对象。</p>

<p>另外，这两个方法都可以发现NaN，弥补了数组的IndexOf方法的不足。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="kc">NaN</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="kc">NaN</span><span class="p">)</span>	<span class="c1">// -1</span>

<span class="p">[</span><span class="kc">NaN</span><span class="p">].</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">y</span> <span class="o">=&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="kc">NaN</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>	    <span class="c1">// 0</span></code></pre></figure>

<p>上面代码中，indexOf方法无法识别数组的NaN成员，但是findIndex方法可以借助Object.is方法做到。</p>

<h3 id="fill">5. 数组实例的fill()</h3>

<p>fill方法使用给定值，填充一个数组。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">].</span><span class="nx">fill</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>	<span class="c1">// [7, 7, 7]</span>

<span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>	<span class="c1">// [7, 7, 7]</span></code></pre></figure>

<p>上面代码表明，fill方法用于空数组的初始化非常方便。数组中已有的元素，会被全部抹去。</p>

<p>fill方法还可以接受第二个和第三个参数，用于指定填充的起始位置和结束位置。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">].</span><span class="nx">fill</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>	<span class="c1">// ['a', 7, 'c']</span></code></pre></figure>

<p>上面代码表示，fill方法从1号位开始，向原数组填充7，到2号位之前结束。</p>

<h3 id="entrieskeysvalues">6. 数组实例的entries()，keys()和values()</h3>

<p>ES6提供三个新的方法——entries()，keys()和values()——用于遍历数组。它们都返回一个遍历器对象（详见《Iterator》），可以用for…of循环进行遍历，唯一的区别是keys()是对键名的遍历、values()是对键值的遍历，entries()是对键值对的遍历。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">index</span> <span class="nx">of</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">].</span><span class="nx">keys</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// 0</span>
<span class="c1">// 1</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">elem</span> <span class="nx">of</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">].</span><span class="nx">values</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// 'a'</span>
<span class="c1">// 'b'</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="p">[</span><span class="nx">index</span><span class="p">,</span> <span class="nx">elem</span><span class="p">]</span> <span class="nx">of</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">].</span><span class="nx">entries</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">elem</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// 0 "a"</span>
<span class="c1">// 1 "b"</span></code></pre></figure>

<p>如果不使用for…of循环，可以手动调用遍历器对象的next方法，进行遍历。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">letter</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">];</span>
<span class="kd">let</span> <span class="nx">entries</span> <span class="o">=</span> <span class="nx">letter</span><span class="p">.</span><span class="nx">entries</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">entries</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// [0, 'a']</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">entries</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// [1, 'b']</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">entries</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// [2, 'c']</span></code></pre></figure>

<h3 id="includes">7. 数组实例的includes()</h3>

<p>Array.prototype.includes方法返回一个布尔值，表示某个数组是否包含给定的值，与字符串的includes方法类似。该方法属于ES7，但Babel转码器已经支持。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>     <span class="c1">// true</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>     <span class="c1">// false</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">NaN</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="kc">NaN</span><span class="p">);</span> <span class="c1">// true</span></code></pre></figure>

<p>该方法的第二个参数表示搜索的起始位置，默认为0。如果第二个参数为负数，则表示倒数的位置，如果这时它大于数组长度（比如第二个参数为-4，但数组长度为3），则会重置为从0开始。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>  <span class="c1">// false</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// true</span></code></pre></figure>

<p>没有该方法之前，我们通常使用数组的indexOf方法，检查是否包含某个值。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span></code></pre></figure>

<p>indexOf方法有两个缺点，一是不够语义化，它的含义是找到参数值的第一个出现位置，所以要去比较是否不等于-1，表达起来不够直观。二是，它内部使用严格相当运算符（===）进行判断，这会导致对NaN的误判。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="kc">NaN</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="kc">NaN</span><span class="p">)</span>	<span class="c1">// -1</span></code></pre></figure>

<p>includes使用的是不一样的判断算法，就没有这个问题。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span><span class="kc">NaN</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="kc">NaN</span><span class="p">)</span>	<span class="c1">// true</span></code></pre></figure>

<p>下面代码用来检查当前环境是否支持该方法，如果不支持，部署一个简易的替代版本。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">contains</span> <span class="o">=</span> <span class="p">(()</span> <span class="o">=&gt;</span>
  <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">includes</span>
    <span class="p">?</span> <span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
    <span class="p">:</span> <span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">el</span> <span class="o">=&gt;</span> <span class="nx">el</span> <span class="o">===</span> <span class="nx">value</span><span class="p">)</span>
<span class="p">)();</span>
<span class="nx">contains</span><span class="p">([</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">],</span> <span class="s2">"baz"</span><span class="p">);</span> <span class="c1">// =&gt; false</span></code></pre></figure>

<p>另外，Map和Set数据结构有一个has方法，需要注意与includes区分。</p>

<p>Map结构的has方法，是用来查找键名的，比如Map.prototype.has(key)、WeakMap.prototype.has(key)、Reflect.has(target, propertyKey)。</p>

<p>Set结构的has方法，是用来查找值的，比如Set.prototype.has(value)、WeakSet.prototype.has(value)。</p>

<h3 id="section">8. 数组的空位</h3>

<p>数组的空位指，数组的某一个位置没有任何值。比如，Array构造函数返回的数组都是空位。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Array</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">// [, , ,]</span></code></pre></figure>

<p>上面代码中，Array(3)返回一个具有3个空位的数组。</p>

<p>注意，空位不是undefined，一个位置的值等于undefined，依然是有值的。空位是没有任何值，in运算符可以说明这一点。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="mi">0</span> <span class="k">in</span> <span class="p">[</span><span class="kc">undefined</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">]</span> <span class="c1">// true</span>
<span class="mi">0</span> <span class="k">in</span> <span class="p">[,</span> <span class="p">,</span> <span class="p">,]</span> <span class="c1">// false</span></code></pre></figure>

<p>上面代码说明，第一个数组的0号位置是有值的，第二个数组的0号位置没有值。</p>

<p>ES5对空位的处理，已经很不一致了，大多数情况下会忽略空位。</p>

<p>forEach(), filter(), every() 和some()都会跳过空位。</p>

<p>map()会跳过空位，但会保留这个值</p>

<p>join()和toString()会将空位视为undefined，而undefined和null会被处理成空字符串。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// forEach方法</span>
<span class="p">[,</span><span class="s1">'a'</span><span class="p">].</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">x</span><span class="p">,</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">));</span> <span class="c1">// 1</span>

<span class="c1">// filter方法</span>
<span class="p">[</span><span class="s1">'a'</span><span class="p">,,</span><span class="s1">'b'</span><span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">)</span> <span class="c1">// ['a','b']</span>

<span class="c1">// every方法</span>
<span class="p">[,</span><span class="s1">'a'</span><span class="p">].</span><span class="nx">every</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span><span class="o">===</span><span class="s1">'a'</span><span class="p">)</span> <span class="c1">// true</span>

<span class="c1">// some方法</span>
<span class="p">[,</span><span class="s1">'a'</span><span class="p">].</span><span class="nx">some</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">!==</span> <span class="s1">'a'</span><span class="p">)</span> <span class="c1">// false</span>

<span class="c1">// map方法</span>
<span class="p">[,</span><span class="s1">'a'</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// [,1]</span>

<span class="c1">// join方法</span>
<span class="p">[,</span><span class="s1">'a'</span><span class="p">,</span><span class="kc">undefined</span><span class="p">,</span><span class="kc">null</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">'#'</span><span class="p">)</span> <span class="c1">// "#a##"</span>

<span class="c1">// toString方法</span>
<span class="p">[,</span><span class="s1">'a'</span><span class="p">,</span><span class="kc">undefined</span><span class="p">,</span><span class="kc">null</span><span class="p">].</span><span class="nx">toString</span><span class="p">()</span> <span class="c1">// ",a,,"</span></code></pre></figure>

<p>ES6则是明确将空位转为undefined。</p>

<p>Array.from方法会将数组的空位，转为undefined，也就是说，这个方法不会忽略空位。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">([</span><span class="s1">'a'</span><span class="p">,,</span><span class="s1">'b'</span><span class="p">])</span>	<span class="c1">// [ "a", undefined, "b" ]</span></code></pre></figure>

<p>扩展运算符（…）也会将空位转为undefined。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[...[</span><span class="s1">'a'</span><span class="p">,,</span><span class="s1">'b'</span><span class="p">]]</span>		<span class="c1">// [ "a", undefined, "b" ]</span></code></pre></figure>

<p>copyWithin()会连空位一起拷贝。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[,</span><span class="s1">'a'</span><span class="p">,</span><span class="s1">'b'</span><span class="p">,,].</span><span class="nx">copyWithin</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> 	<span class="c1">// [,"a",,"a"]</span></code></pre></figure>

<p>fill()会将空位视为正常的数组位置。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span> 		<span class="c1">// ["a","a","a"]</span></code></pre></figure>

<p>for…of循环也会遍历空位。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[,</span> <span class="p">,];</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="nx">of</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// 1</span>
<span class="c1">// 1</span></code></pre></figure>

<p>上面代码中，数组arr有两个空位，for…of并没有忽略它们。如果改成map方法遍历，空位是会跳过的。</p>

<p>entries()、keys()、values()、find()和findIndex()会将空位处理成undefined。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// entries()</span>
<span class="p">[...[,</span><span class="s1">'a'</span><span class="p">].</span><span class="nx">entries</span><span class="p">()]</span> <span class="c1">// [[0,undefined], [1,"a"]]</span>

<span class="c1">// keys()</span>
<span class="p">[...[,</span><span class="s1">'a'</span><span class="p">].</span><span class="nx">keys</span><span class="p">()]</span> <span class="c1">// [0,1]</span>

<span class="c1">// values()</span>
<span class="p">[...[,</span><span class="s1">'a'</span><span class="p">].</span><span class="nx">values</span><span class="p">()]</span> <span class="c1">// [undefined,"a"]</span>

<span class="c1">// find()</span>
<span class="p">[,</span><span class="s1">'a'</span><span class="p">].</span><span class="nx">find</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">)</span> <span class="c1">// undefined</span>

<span class="c1">// findIndex()</span>
<span class="p">[,</span><span class="s1">'a'</span><span class="p">].</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">)</span> <span class="c1">// 0</span></code></pre></figure>

<p>由于空位的处理规则非常不统一，所以建议避免出现空位。</p>


  </div>

</article>
<!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="/front/article/2017/02/24/es6-6" data-title="ES6语法之六（数组的扩展）" data-url="/front/article/2017/02/24/es6-6.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"lq1228"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
<!-- 多说公共JS代码 end -->

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="friend-link">
        <div class="friend-title">友情链接</div>
        
            <a href="https://bystep15.github.io/">
		宝宝树前端团队博客
	    </a>
	
            <a href="http://testudy.github.io/">
		胡继伟
	    </a>
	
            <a href="https://yj1438.github.io/">
		尹杰
	    </a>
	
            <a href="https://github.com/cnsnake11/blog">
		曹楠
	    </a>
	
            <a href="http://www.jianshu.com/users/b7dc4381aed3/">
		姚琪
	    </a>
	
            <a href="https://lilywei739.github.io">
		魏莉
	    </a>
	
            <a href="https://wangjiaoxia.github.io/">
		王娇霞
	    </a>
	
            <a href="http://www.ushtml.com/">
		武明礼
	    </a>
	
            <a href="http://kouyun.me/">
		寇云
	    </a>
	
            <a href="http://brooch.me/">
		郑星宬
	    </a>
	
            <a href="http://zhanyouwei.com/">
		占友伟
	    </a>
	
            <a href="">
		
	    </a>
	
    </div>

    <div class="copyright">
      <p>lq1228.github.io</p>
    </div>

  </div>

</footer>


  </body>

</html>
